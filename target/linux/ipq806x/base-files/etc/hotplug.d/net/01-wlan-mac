#!/bin/sh

now=`date`

. /lib/functions.sh
. /lib/functions/system.sh

board=$(board_name)

if [ "$ACTION" == "add" ]; then
        case "$board" in
        "netgear,wac510")
                if [ "$INTERFACE" == "wlan0" ] || [ "$INTERFACE" == "wlan1" ]; then
                        offset=$((${INTERFACE: -1} + 2))
                        new_mac=$(macaddr_add $(cat /sys/class/net/eth0/address) +$offset)
                        old_mac=$(cat /sys/class/net/$INTERFACE/address)
                        if [ ! "$old_mac" == "$new_mac" ]; then
                                echo "$now NET Resetting MAC address of $INTERFACE Offset: $offset" >> /tmp/tim.log
                                echo "$now NET Changing mac from $old_mac to $new_mac" >> /tmp/tim.log
                                ifconfig $INTERFACE down
                                ifconfig $INTERFACE hw ether $new_mac
                                ifconfig $INTERFACE up
                        fi
                fi
                ;;
        esac
fi

